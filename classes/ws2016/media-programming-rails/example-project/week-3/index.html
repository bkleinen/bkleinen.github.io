<!doctype html><html><head><title>Example Project for Web Technology - Week 3 - Prof. Dr. Barne Kleinen</title><link rel=icon href=https://bkleinen.github.io/favicon.ico>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=theme-color content="#1A94D2"><link rel=stylesheet href=https://bkleinen.github.io/css/styles.min.css media=screen></head><body><div class=container-fluid><header class="row m-b-5"><div class="col-md-2 c2">&nbsp;</div><div class="col-md-10 c1 p-2"><div class=container-flex><div class=row><div class=col-9><h1 class="c5 title">Media Programming: Web Technology</h1><small>Website of Prof. Dr. Barne Kleinen, Professor for Media Informatics
(<a href=https://imi-bachelor.htw-berlin.de>Bachelor</a>/<a href=https://imi-master.htw-berlin.de>Master</a>)
at <a href=https://www.htw-berlin.de>HTW Berlin</a></small></div><div class=col-3><a href=https://www.htw-berlin.de><img src=https://bkleinen.github.io/images/htw_logo_green.gif alt="HTW Berlin" title="HTW Berlin"></a><br><a href=https://bkleinen.github.io/>Programming and Web Technology @ IMI</a></div></div></div></div></header><main class="row p-0"><nav class="col-md-2 c2"><div class=nav><ul class="nav flex-md-column"><li class=nav-item></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/><div>Home</div></a></li><li class=nav-item><a class="nav-link dropdown-toggle active" data-bs-toggle=dropdown href=# role=button aria-expanded=false>Classes</a><div class=dropdown-menu><a class=dropdown-item href=https://bkleinen.github.io/classes/ws2023/info1/>B 1 Informatik 1</a>
<a class=dropdown-item href=https://bkleinen.github.io/classes/ws2023/m1-web/>M 1 Mediaprogramming</a>
<a class=dropdown-item href=https://bkleinen.github.io/classes/ws2023/m17-masterseminar/>M 17.1 Masterseminar</a>
<a class=dropdown-item href=https://bkleinen.github.io/classes/ws2023/>All WS 2023/24</a>
<a class=dropdown-item href=https://bkleinen.github.io/classes/>All Classes</a></div></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/material/><div>Material</div></a></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/software_projects/><div>Software Projects</div></a></li><li class=nav-item><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false>Studies</a><div class=dropdown-menu><a class=dropdown-item href=https://bkleinen.github.io/studies/thesis/>Thesis</a>
<a class=dropdown-item href=https://bkleinen.github.io/studies/ic/>IC</a>
<a class=dropdown-item href=https://bkleinen.github.io/studies/grading/>Grading Info</a></div></li><li class=nav-item><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false>Misc</a><div class=dropdown-menu><a class=dropdown-item href=https://bkleinen.github.io/misc/links/>Links to frequently used pages</a>
<a class=dropdown-item href=https://bkleinen.github.io/misc/trans/>Trans@HTW</a>
<a class=dropdown-item href=https://bkleinen.github.io/misc/lsf/>Email Collector for LSF</a></div></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/contact/><div>Contact Info</div></a></li><ul></div></nav><div class="col-md-10 c3"><div class=outer><nav aria-label=breadcrumb role=navigation><ol class="breadcrumb breadcrumb-thin"><li class=breadcrumb-item><a href=https://bkleinen.github.io/>Home</a></li><li class=breadcrumb-item><a href=https://bkleinen.github.io/classes/>classes</a></li><li class=breadcrumb-item><a href=https://bkleinen.github.io/classes/ws2016/>ws2016</a></li><li class=breadcrumb-item><a href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/>media-programming-rails</a></li><li class=breadcrumb-item><a href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/example-project/>example-project</a></li><li class="breadcrumb-item active" aria-current=page>week-3</li></ol></nav></div><div class=coursenav><ul class="nav nav-tabs"><li class=nav-item><a class="nav-link active" href=https://bkleinen.github.io/classes/ws2016/media-programming-rails>M1 Media Programming: Web Technology</a></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/schedule/>Schedule</a></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/overall-schedule/>Overall Schedule</a></li><li class=nav-item><a class=nav-link href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/assignments>Assignments</a></li><li class=nav-item><a class="nav-link active" href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/example-project>Example Project</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-bs-toggle=dropdown href=# role=button aria-expanded=false>External Links</a><div class=dropdown-menu><a class=dropdown-item target=ex_link href="https://moodle.htw-berlin.de/course/view.php?id=11772">Moodle</a>
<a class=dropdown-item target=ex_link href=https://github.com/media-programming-rails>Github</a>
<a class=dropdown-item target=ex_link href="https://lsf.htw-berlin.de/qisserver/rds?state=wsearchv&amp;search=2&amp;veranstaltung.veranstid=119640">LSF</a></div></li></ul></div><div class=container-fluid><h2 class=followed>Example Project for Web Technology - Week 3</h2><header class=following><a data-bs-toggle=collapse href=#tocContent role=button aria-expanded=false aria-controls=tocContent>Table of Contents
</a>&nbsp;&nbsp;&nbsp;&nbsp;
<a href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/example-project/week-2/>&lt;prev</a>
<a href=https://bkleinen.github.io/classes/ws2016/media-programming-rails/example-project/week-4/>next></a></header><div class=collapse id=tocContent><nav id=TableOfContents><ul><li><a href=#testing-setting-up-a-deployment-workflow-and-some-ruby>Testing, Setting up a Deployment Workflow, and some Ruby</a><ul><li><a href=#1-create-at-least-one-happy-path-feature-test-for-each-person-on-your-team-use-capybara>1. Create at least one happy-path feature test for each person on your team. Use Capybara.</a></li><li><a href=#2-test-cleanup>2. Test cleanup</a></li><li><a href=#3-create-test-data-for-the-tests-using-fixtures>3. Create test data for the tests using fixtures.</a></li><li><a href=#back-to-1-create-at-least-one-happy-path-feature-test-for-each-story-youve-implemented-so-far-use-capybara>(back to: )1. Create at least one happy-path feature test for each story you&rsquo;ve implemented so far. Use Capybara.</a></li><li><a href=#4-create-a-model-test>4. Create a model test.</a></li><li><a href=#5-create-seed-data-for-playing-around-in-development-mode-and-also-some-if-you-needwant-seed-data-in-production>5. Create seed data for playing around in development mode, and also some if you need/want seed data in production.</a></li><li><a href=#6-set-up-automated-integration-tests-on-travis-ci-for-your-project-include-a-build-passing-button-in-your-readme>6. Set up automated integration tests on travis ci for your project. Include a &ldquo;build passing&rdquo; button in your readme.</a></li><li><a href=#7-set-up-an-automated-deployment-to-heroku-for-your-project>7. Set up an Automated Deployment to Heroku for your project.</a></li><li><a href=#9-automatically-deploy-every-successful-build-from-travis>9. Automatically Deploy every successful Build from Travis.</a></li></ul></li></ul></nav></div><h1 id=week-3>Week 3</h1><ul><li><a href=https://github.com/media-programming-rails/example-app>Example Project on GitHub</a></li></ul><h2 id=testing-setting-up-a-deployment-workflow-and-some-ruby>Testing, Setting up a Deployment Workflow, and some Ruby</h2><h3 id=1-create-at-least-one-happy-path-feature-test-for-each-person-on-your-team-use-capybara>1. Create at least one happy-path feature test for each person on your team. Use Capybara.</h3><p>I demonstrate this on the story</p><ul><li>A user kann log an habit as completed on that day by simply clicking on a button in the habit list.</li></ul><p>Before I start working on that, I should clean up the generated tests and create some test data for the Habits.</p><h3 id=2-test-cleanup>2. Test cleanup</h3><p>Clean up the generated test files (those generated by rails generate scaffold) that you don&rsquo;t need.
Run <code>rails test</code> to see which tests are failing. Make sure that all tests are
running before actually creating tests on your own!
(It might be useful to keep some of the generated tests around while you haven&rsquo;t
implemented enough tests to
be confident that they cover enough of your application - we&rsquo;ll see an excellent example of this later!)</p><pre><code>rails test
</code></pre><p>I get errors because of my model change (column last was deleted), so I have to look at the third step right away:</p><pre><code>Error:
LogEntriesControllerTest#test_should_get_edit:
ActiveRecord::Fixture::FixtureError: table &quot;habits&quot; has no column named &quot;last&quot;.
</code></pre><p>I keep the tests for now as, while their not doing much, they exercise the code
that I don&rsquo;t have tests for yet.</p><h3 id=3-create-test-data-for-the-tests-using-fixtures>3. Create test data for the tests using fixtures.</h3><p>Rails has created fixtures for you if you used the scaffold generator. Mine got
broken when I refactored last_done by moving it to an association.</p><p>For setting up your fixtures, see the API Documentation on Fixtures: <a href=https://api.rubyonrails.org/classes/ActiveRecord/FixtureSet.html>ActiveRecord::FixtureSet</a></p><p>See commit week-3-1 for the fix and the fixtures using the association. I&rsquo;ve
also added a model test to ensure the association is correctly set up.</p><h3 id=back-to-1-create-at-least-one-happy-path-feature-test-for-each-story-youve-implemented-so-far-use-capybara>(back to: )1. Create at least one happy-path feature test for each story you&rsquo;ve implemented so far. Use Capybara.</h3><p>I demonstrate this on the story</p><ul><li>A user kann log an habit as completed on that day by simply clicking on a button in the habit list.</li></ul><p>Steps:</p><ul><li>add the capybara gem and capybara dsl to your tests - see the Capybara doc and my commit week-3-2</li><li>create the test.</li><li>use the launchy gem to save_and_open_page if stuck - see week-3-3</li></ul><p>I&rsquo;ve modified the page to include an id for the button to click - this makes
the tests less brittle. For the actual test see commit week-3-4.</p><h3 id=4-create-a-model-test>4. Create a model test.</h3><p>If you have implemented functionality in your model, implement a unit test on the for that method.
I&rsquo;ve implemented a setter that actually modifies the association, so I write a test
for that:</p><pre><code>@habit.last_log_date = Date.today
</code></pre><p>See week-3-5. Note that I only check on the behaviour of habit, I&rsquo;m only
testing Habit&rsquo;s public interface, as that&rsquo;s the interface I actually use in
my application, leaving it to Habit how it actually stores it&rsquo;s log.</p><p>(I&rsquo;m leaving the one association test as an example for you).</p><p>If you haven&rsquo;t implemented any functionality in your model, maybe you find something
that should go in the model? If not, just write tests that test if the
associations are set up correctly.</p><h3 id=5-create-seed-data-for-playing-around-in-development-mode-and-also-some-if-you-needwant-seed-data-in-production>5. Create seed data for playing around in development mode, and also some if you need/want seed data in production.</h3><p>see db/seed.rb for an example.</p><h3 id=6-set-up-automated-integration-tests-on-travis-ci-for-your-project-include-a-build-passing-button-in-your-readme>6. Set up automated integration tests on travis ci for your project. Include a &ldquo;build passing&rdquo; button in your readme.</h3><p>Go to <a href=https://travis-ci.org>https://travis-ci.org</a> and set up a user account/
log in using your github account. See <a href=https://docs.travis-ci.com/user/languages/ruby/>https://docs.travis-ci.com/user/languages/ruby/</a> for settings.</p><p>What I did:</p><ul><li>granted travis access to the organisation media-programming-rails <a href=https://github.com/settings/connections/applications/>https://github.com/settings/connections/applications/</a></li><li>went to travis-ci.org, Account (upper right), sync account, chose organisation and flicked on the repository (organisation did not show up in the list, but it was possible to access it by entering the url <a href=https://travis-ci.org/profile/media-programming-rails>https://travis-ci.org/profile/media-programming-rails</a> manually)</li><li>created travis configuration files. As I&rsquo;m using rvm and have a .ruby-version file anyway, I use that for travis. Travis runs rake as default script, I could alter it to rails test but as rails test is the rake default task, I leave it at that.</li><li>switched (and merged) to master</li><li>pushed to github</li><li>wait for first build on <a href=https://travis-ci.org/media-programming-rails/example-app>https://travis-ci.org/media-programming-rails/example-app</a></li><li>as you can see, it took me 3 tries to get the first running build on travis.</li></ul><h3 id=7-set-up-an-automated-deployment-to-heroku-for-your-project>7. Set up an Automated Deployment to Heroku for your project.</h3><p>Heroku has a detailed documentation on how to create and deploy a rails app
to heroku: <a href=https://devcenter.heroku.com/articles/getting-started-with-rails5>https://devcenter.heroku.com/articles/getting-started-with-rails5</a></p><p>The following steps worked for me:</p><ul><li>create an account on heroku.com</li><li>add pg gem for postgres database. week-3-7</li><li>(re-)installed the heroku toolbelt</li><li>heroku login</li><li>heroku create</li><li>heroku rename mediaprogramming</li><li>git push heroku master</li><li>heroku open</li></ul><p>Yields an error. This is because I don&rsquo;t have a page for / !
<a href=https://mediaprogramming.herokuapp.com/habits>https://mediaprogramming.herokuapp.com/habits</a> works, though.
I also realize that I have forgotten to migrate the database:</p><ul><li>heroku run rails db:migrate</li><li>heroku run rails db:seed (if applicable)</li></ul><p>I get a couple of warnings:</p><p>I&rsquo;ve decided to ignore them mostly for now, just added the ruby version to the Gemfile.</p><h4 id=8-for-the-bored-set-up-a-build-matrix-testing-both-against-postgres-and-sqlite-on-travis>8. For the bored: set up a build matrix testing both against postgres and sqlite on travis</h4><ul><li><a href=https://docs.travis-ci.com/user/database-setup/#PostgreSQL>Travis Doc for Postgres</a></li><li><a href=https://docs.travis-ci.com/user/environment-variables/>Travis environment variables</a></li></ul><p>And, indeed, The build passes for sqlite and fails for postgres!</p><p>See the log of <a href=https://travis-ci.org/media-programming-rails/example-app/builds/170085481>Build 4</a>,
the job for <a href=https://travis-ci.org/media-programming-rails/example-app/jobs/170085482>postgres</a>.</p><p>The generated controller delets an habit, and postgres
(or rather the pg gem) throws an exception PG::ForeignKeyViolation because there&rsquo;s
a dangling LogEntry which references the deleted habit. In fact, I haven&rsquo;t taken
care about how to delete habits at all. As log_entrys make no sense without the
habit, I add an dependent: :destroy to the association.</p><p>The error was visible on Heroku: If you deleted an habit on heroku, you get an
error message: (you have to look in the logs using <code>heroku logs</code> ):</p><p>Thus, &ldquo;travis postgres fix 1: use habit without log_entry&rdquo; really makes things
worse as the tests now pass on travis, but the bug is still in production.</p><h3 id=9-automatically-deploy-every-successful-build-from-travis>9. Automatically Deploy every successful Build from Travis.</h3><p>See <a href=https://docs.travis-ci.com/user/deployment/heroku/>Deployment Doc on travis</a>.
This worked for me:</p><ul><li><p>installed travis gem: <code>gem install travis</code></p></li><li><p>have travis automatically add and encrypt heroku&rsquo;s api key:</p><p><code>travis encrypt $(heroku auth:token) --add deploy.api_key</code></p></li><li><p>edited travis.yml deployment part</p></li><li><p>push to github</p></li></ul><p>You can check the heroku deployments with:</p><pre><code>`heroku releases`
</code></pre><p>to see which commit is actually deployed on heroku.</p><p>Note: you only need this condition if you have a second build for the sqlite
database.
on:
condition: &ldquo;$DB = postgres&rdquo;</p></div></div></div></main><footer class="row p-0"><div class="col-md-2 c2">&nbsp;</div><div class="col-md-10 c4"><small><hr><div class=container-fluid><div class=row><div class=col-9><a href=https://bkleinen.github.io/contact>Prof. Dr. Barne Kleinen</a>,
<a href=https://www.htw-berlin.de>HTW Berlin</a>,
<a href=https://www.f4.htw-berlin.de/>FB4</a>, <a href=https://imi-bachelor.htw-berlin.de/>International Media and Computing</a>.
&nbsp;&nbsp;&dash;&nbsp;&nbsp;</div><div class=col-3><a href=https://bkleinen.github.io/contact/impressum>Impressum</a>,
<a href=https://bkleinen.github.io/contact/datenschutzerklaerung>Datenschutzerkl√§rung</a></div></div><div class=row><div class=col-9>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>Creative Commons Attribution-NonCommercial 4.0 International License</a>.<br><small>This page was authored by: kleinen</small></div><div class=col-3><a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons Licence" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a></div></div><div class=row><div class=col-sm-12></div></div></div></small></div></footer><script>let sortTables=!1,stripedTables=!0</script><script src=https://bkleinen.github.io/js/bundle.min.a69b27a48bd90e096b841772016dd704ae8e8d7882bffd22329ca8a626df8e40.js defer></script></body></html>